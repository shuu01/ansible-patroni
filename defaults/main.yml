---
# defaults file for patroni

# patroni variables
patroni_pg_port: 5432
patroni_archive_command: "mkdir -p ../wal_archive && test ! -f ../wal_archive/%f && cp %p ../wal_archive/%f"
patroni_scope: cluster

patroni_rest_username: patroni-username
patroni_rest_password: patroni-password

patroni_dcs: etcd

# postgresql variables (override it with group_vars or host_vars if needed)
postgresql_version: 11

postgresql_apt_key_id: "ACCC4CF8"
postgresql_apt_key_url: "https://www.postgresql.org/media/keys/ACCC4CF8.asc"
postgresql_apt_repository: "deb http://apt.postgresql.org/pub/repos/apt/ {{ ansible_distribution_release }}-pgdg main"

postgresql_bin: "/usr/lib/postgresql/{{ postgresql_version }}/bin"
postgresql_data: "/var/lib/postgresql/{{ postgresql_version }}/data"

postgresql_superuser_username: postgres
postgresql_superuser_password: superuser-password
postgresql_replication_username: replicator
postgresql_replication_password: "{{ postgresql_superuser_password }}"

postgresql_create_main_cluster: false

patroni_pg_hba:
  - { type: "host",  database: "all",         user: "all",                                   address: "0.0.0.0/0", method: "md5" }
  - { type: "host",  database: "replication", user: "{{ postgresql_replication_username }}", address: "0.0.0.0/0", method: "md5" }
  - { type: "local", database: "all",         user: "{{ postgresql_superuser_username }}",   address: "",        method: "peer" }

patroni_pg_parameters:
  - { option: synchronous_commit,        value: "off" }
  - { option: synchronous_standby_names, value: "'*'" }
  - { option: shared_preload_libraries,  value: "pg_stat_statements" }
  - { option: archive_mode,              value: "on" }
  - { option: wal_level,                 value: "hot_standby" }
  - { option: archive_command,           value: "{{ patroni_archive_command }}" }
  - { option: max_wal_senders,           value: "10" }
  - { option: wal_keep_segments,         value: "8" }
  - { option: archive_timeout,           value: "1800s" }
  - { option: max_replication_slots,     value: "5" }
  - { option: hot_standby,               value: "on" }
  - { option: wal_log_hints,             value: "on" }

# etcd variables
etcd_host: 127.0.0.1
etcd_port: 2379
